  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.9ms)[0m  [1m[34m          SELECT schemaname || '.' || tablename
          FROM pg_tables
          WHERE
            tablename !~ '_prt_' AND
             tablename <> 'schema_migrations'  AND tablename <> 'ar_internal_metadata'  AND
            schemaname = ANY (current_schemas(false))
[0m
  [1m[35m (1.4ms)[0m  [1m[34mselect table_name from information_schema.views where table_schema = 'processor_gateway_test'[0m
  [1m[35m (24.1ms)[0m  [1m[35mTRUNCATE TABLE "public"."processor_gateway_accounts", "public"."processor_gateway_raw_requests", "public"."processor_gateway_card_products", "public"."processor_gateway_transactions", "public"."processor_gateway_cards" RESTART IDENTITY CASCADE;[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" ENABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:53.322559"], ["updated_at", "2020-12-26 14:54:53.322559"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "542eb758282f545b457dfe9b36ae4ad6"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:53.490222"], ["updated_at", "2020-12-26 14:54:53.490222"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "c5cfaaefb720"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "c5cfaaefb720"], ["card_product_id", "default-physical"], ["processor_card_id", "c5cfaaefb720"], ["pan", "4111111111140675"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:53.567274"], ["updated_at", "2020-12-26 14:54:53.567274"], ["options", "{\"marqeta_user_token\":\"99012a75d7a5ec1bbf9d87f8622abac6\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "c5cfaaefb720"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "a5c41069-7d06-401d-86c3-faf1395bbf19"], ["type", "authorization"], ["card_id", "c5cfaaefb720"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:53.572197"], ["created_at", "2020-12-26 14:54:53.601192"], ["processor_transaction_id", "1c13d9fa-d9cb-4dca-abe1-4ab72e250bbe"], ["card_acceptor_id", "52d27080-f820-4ca0-a0ed-029ede11f094"], ["acquirer_id", "da1b051a-9e16-44d0-8b9c-f5fa510f719f"], ["terminal_id", "1d525532-6542-4b98-aeb4-d5dcdad8d5bd"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "1c13d9fa-d9cb-4dca-abe1-4ab72e250bbe"], ["amount_approved", 10000], ["id", "a5c41069-7d06-401d-86c3-faf1395bbf19"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:53.649795"], ["updated_at", "2020-12-26 14:54:53.649795"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "db1d8794797aa5313184d0e08681417e"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:53.661107"], ["updated_at", "2020-12-26 14:54:53.661107"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "7c0750092d1f"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "7c0750092d1f"], ["card_product_id", "default-physical"], ["processor_card_id", "7c0750092d1f"], ["pan", "4111111111199698"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:53.674005"], ["updated_at", "2020-12-26 14:54:53.674005"], ["options", "{\"marqeta_user_token\":\"0c39ebe327a082ba643b7e5c77bf6f3f\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "7c0750092d1f"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "10e9dfc3-b325-455d-bbda-1a17a6fb1444"], ["type", "authorization"], ["card_id", "7c0750092d1f"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:53.678445"], ["created_at", "2020-12-26 14:54:53.683815"], ["processor_transaction_id", "a40964ef-91f7-4211-b839-7af02a5cd78f"], ["card_acceptor_id", "a124ce9e-a6cf-4ce9-8942-f06aed0244bd"], ["acquirer_id", "3641ca63-cee3-4729-873f-85d2867f4dab"], ["terminal_id", "1405b83e-32f9-4717-a8ae-4d7d1181586e"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:53.704235"], ["updated_at", "2020-12-26 14:54:53.704235"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "47e1ff0d7f348dc0916508f13692d520"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:53.715443"], ["updated_at", "2020-12-26 14:54:53.715443"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "269d1f3fe400"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "269d1f3fe400"], ["card_product_id", "default-physical"], ["processor_card_id", "269d1f3fe400"], ["pan", "4111111111113833"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:53.727519"], ["updated_at", "2020-12-26 14:54:53.727519"], ["options", "{\"marqeta_user_token\":\"a8fe89c56ee0fea48fd853c55bec7203\"}"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "269d1f3fe400"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "99a0ec36-b9e1-4500-b55e-4d804e0e7b05"], ["type", "authorization"], ["card_id", "269d1f3fe400"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:53.731819"], ["created_at", "2020-12-26 14:54:53.737236"], ["processor_transaction_id", "6b6069cf-827d-47ef-b738-01a15f48ce14"], ["card_acceptor_id", "211deb48-62fd-4a63-8ce0-2c53d54be943"], ["acquirer_id", "e2e770d5-4a28-43c7-a5ee-7542eb341a69"], ["terminal_id", "b60d626f-9ecf-41d2-9e41-e3db48a54c7b"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "6b6069cf-827d-47ef-b738-01a15f48ce14"], ["amount_approved", 10000], ["id", "99a0ec36-b9e1-4500-b55e-4d804e0e7b05"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "c9133a2d-f3be-4f30-a713-0d3cd377685a"], ["type", "capture"], ["parent_transaction_id", "99a0ec36-b9e1-4500-b55e-4d804e0e7b05"], ["card_id", "269d1f3fe400"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:53.731819"], ["created_at", "2020-12-26 14:54:53.752330"], ["processor_transaction_id", "6b6069cf-827d-47ef-b738-01a15f48ce14"], ["card_acceptor_id", "211deb48-62fd-4a63-8ce0-2c53d54be943"], ["acquirer_id", "e2e770d5-4a28-43c7-a5ee-7542eb341a69"], ["terminal_id", "b60d626f-9ecf-41d2-9e41-e3db48a54c7b"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.6ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "6b6069cf-827d-47ef-b738-01a15f48ce14"], ["amount_approved", 10000], ["id", "c9133a2d-f3be-4f30-a713-0d3cd377685a"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:53.774303"], ["updated_at", "2020-12-26 14:54:53.774303"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "62995d71911fda64153a38d94e4313c3"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:53.784147"], ["updated_at", "2020-12-26 14:54:53.784147"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "aacd4748b53b"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "aacd4748b53b"], ["card_product_id", "default-physical"], ["processor_card_id", "aacd4748b53b"], ["pan", "4111111111185595"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:53.796637"], ["updated_at", "2020-12-26 14:54:53.796637"], ["options", "{\"marqeta_user_token\":\"90f72f7069cfb4c19a96bae9e36eced8\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "aacd4748b53b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "9bb5bd8c-535d-4cd0-bb6b-2e411885e756"], ["type", "authorization"], ["card_id", "aacd4748b53b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:53.800707"], ["created_at", "2020-12-26 14:54:53.806039"], ["processor_transaction_id", "97d18004-3c73-459b-9372-b9a82bf41fef"], ["card_acceptor_id", "f154ac31-5c14-4ae5-a477-01c309cb5fca"], ["acquirer_id", "305b66a0-cdfa-4369-90c2-f3d203c92ea6"], ["terminal_id", "609cece9-5d68-4c67-ac0b-8195a53250d8"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:53.825138"], ["updated_at", "2020-12-26 14:54:53.825138"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "cdae24e0ad004d32d9d453d3a72fa800"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:53.836144"], ["updated_at", "2020-12-26 14:54:53.836144"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "c5e5e9418cd5"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "c5e5e9418cd5"], ["card_product_id", "default-physical"], ["processor_card_id", "c5e5e9418cd5"], ["pan", "4111111111120528"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:53.848796"], ["updated_at", "2020-12-26 14:54:53.848796"], ["options", "{\"marqeta_user_token\":\"c6f6ea5389ea710562a4bbc9d3cde5e7\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "c5e5e9418cd5"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "b318d1af-e712-4250-b40e-adf396287a1e"], ["type", "authorization"], ["card_id", "c5e5e9418cd5"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:53.853150"], ["created_at", "2020-12-26 14:54:53.858774"], ["processor_transaction_id", "764bb9e8-83d5-41e7-9d57-68b17ae03cae"], ["card_acceptor_id", "0b50cb0b-d4b9-45da-a2f7-0cf59a2e60cf"], ["acquirer_id", "45a63e6c-8a78-4b2a-be46-218fdc123156"], ["terminal_id", "2c0b5a89-739f-445e-96ff-8abf644f5a7c"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "764bb9e8-83d5-41e7-9d57-68b17ae03cae"], ["amount_approved", 10000], ["id", "b318d1af-e712-4250-b40e-adf396287a1e"]]
  [1m[35m (1.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:54.068197"], ["updated_at", "2020-12-26 14:54:54.068197"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "ff3aee831d8afa76de4f8797339a1763"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:54.080199"], ["updated_at", "2020-12-26 14:54:54.080199"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "66655531d945"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (1.1ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "66655531d945"], ["card_product_id", "default-physical"], ["processor_card_id", "66655531d945"], ["pan", "4111111111150404"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:54.092989"], ["updated_at", "2020-12-26 14:54:54.092989"], ["options", "{\"marqeta_user_token\":\"3fe71543dc59fc9dfb02daf302cd863f\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "66655531d945"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "a9429a73-d186-42ad-b0b3-1dae507e794d"], ["type", "authorization"], ["card_id", "66655531d945"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:54.100096"], ["created_at", "2020-12-26 14:54:54.105328"], ["processor_transaction_id", "3abaa0b5-449e-4ad2-87de-d5d1e8e27811"], ["card_acceptor_id", "f8df78a0-a606-4746-b7e5-118ee03ae18e"], ["acquirer_id", "18aac787-e5eb-472c-9f06-840cfef30f4a"], ["terminal_id", "7fa794dd-3464-40db-8e07-4dcc50251822"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:54.124991"], ["updated_at", "2020-12-26 14:54:54.124991"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "65b97770c6a194815362edda5a368c2e"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:54.135296"], ["updated_at", "2020-12-26 14:54:54.135296"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "688e566dc72b"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "688e566dc72b"], ["card_product_id", "default-physical"], ["processor_card_id", "688e566dc72b"], ["pan", "4111111111125299"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:54.146761"], ["updated_at", "2020-12-26 14:54:54.146761"], ["options", "{\"marqeta_user_token\":\"c233fc09f579495c2151876bc90ef204\"}"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "688e566dc72b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "1bba549e-ea87-4ad7-82b6-e39088a3ad57"], ["type", "refund"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[37mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "688e566dc72b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "1bba549e-ea87-4ad7-82b6-e39088a3ad57"], ["type", "refund"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "c173787c-c9fc-4c02-8a2c-c326a272a8d6"], ["type", "refund"], ["card_id", "688e566dc72b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:54.150974"], ["created_at", "2020-12-26 14:54:54.162878"], ["processor_transaction_id", "1bba549e-ea87-4ad7-82b6-e39088a3ad57"], ["card_acceptor_id", "d4f77e01-bd0f-4f0d-88f0-dfa009200d12"], ["acquirer_id", "781c153e-182d-4914-b0f1-ab67a5f6ba36"], ["terminal_id", "997edffa-f054-4dc1-b01a-0647a82a8d5c"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.5ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "1bba549e-ea87-4ad7-82b6-e39088a3ad57"], ["amount_approved", 10000], ["id", "c173787c-c9fc-4c02-8a2c-c326a272a8d6"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.4ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:54.183797"], ["updated_at", "2020-12-26 14:54:54.183797"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "7df50002afec937717524218f7d07da1"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:54.194510"], ["updated_at", "2020-12-26 14:54:54.194510"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "72e822f60052"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "72e822f60052"], ["card_product_id", "default-physical"], ["processor_card_id", "72e822f60052"], ["pan", "4111111111195160"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:54.214882"], ["updated_at", "2020-12-26 14:54:54.214882"], ["options", "{\"marqeta_user_token\":\"a9fea7506edf9fdaf5b2bdd11446ec16\"}"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "72e822f60052"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "1a3c308e-fbc6-4478-8a18-00badf1b9597"], ["type", "authorization"], ["card_id", "72e822f60052"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 14:54:54.223032"], ["processor_transaction_id", "01c2550b4fd638a0a69918b3bfc2cd2e"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[36mProcessorGateway::Card Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "72e822f60052"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "01c2550b4fd638a0a69918b3bfc2cd2e"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.5ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "1a3c308e-fbc6-4478-8a18-00badf1b9597"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "112b1535-b010-4756-ad60-8da0b989df7e"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "5a68bd2f-22ad-42f6-82d1-292f7a802f5d"], ["type", "capture"], ["parent_transaction_id", "1a3c308e-fbc6-4478-8a18-00badf1b9597"], ["card_id", "72e822f60052"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:54.242302"], ["created_at", "2020-12-26 14:54:54.253637"], ["processor_transaction_id", "112b1535-b010-4756-ad60-8da0b989df7e"], ["card_acceptor_id", "57364481-46ca-467f-beee-7f1d1c0049af"], ["acquirer_id", "0f7cae90-1df3-41c5-b517-8eac3b9edf25"], ["terminal_id", "ccab4d1a-9e41-4fee-af7b-492351cce347"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "1a3c308e-fbc6-4478-8a18-00badf1b9597"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.6ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "112b1535-b010-4756-ad60-8da0b989df7e"], ["amount_approved", 10000], ["id", "5a68bd2f-22ad-42f6-82d1-292f7a802f5d"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 14:54:54.276448"], ["updated_at", "2020-12-26 14:54:54.276448"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "c3d36b6a79981a423025f485e89ea0b9"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 14:54:54.286997"], ["updated_at", "2020-12-26 14:54:54.286997"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "2d18fa6e5b59"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "2d18fa6e5b59"], ["card_product_id", "default-physical"], ["processor_card_id", "2d18fa6e5b59"], ["pan", "4111111111105723"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 14:54:54.299065"], ["updated_at", "2020-12-26 14:54:54.299065"], ["options", "{\"marqeta_user_token\":\"4719c230ebf6f1c46278429793ce93f5\"}"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "2d18fa6e5b59"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["type", "authorization"], ["card_id", "2d18fa6e5b59"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 14:54:54.307015"], ["processor_transaction_id", "6cd847253bab5f49e1ecb90e38ab6535"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (1.1ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "2d18fa6e5b59"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (1.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "2d18fa6e5b59"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "2d18fa6e5b59"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "2d18fa6e5b59"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "6cd847253bab5f49e1ecb90e38ab6535"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "6cd847253bab5f49e1ecb90e38ab6535"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "6cd847253bab5f49e1ecb90e38ab6535"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.0ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "6cd847253bab5f49e1ecb90e38ab6535"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (1.0ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "69194994-0315-497f-b21e-580be01c299a"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "b6cf5803-4f6b-4dab-bda8-2a7d3b53ef59"], ["type", "capture"], ["parent_transaction_id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["card_id", "2d18fa6e5b59"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 14:54:54.324259"], ["created_at", "2020-12-26 14:54:54.349010"], ["processor_transaction_id", "69194994-0315-497f-b21e-580be01c299a"], ["card_acceptor_id", "72448693-acb1-4e17-a1dd-656e9e827e38"], ["acquirer_id", "0fbf6abc-3a10-4c72-9ef3-1b4e02a5af79"], ["terminal_id", "01420016-d0b3-49d9-a2c1-b894a4f9c047"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (2.3ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.6ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.0ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "69194994-0315-497f-b21e-580be01c299a"], ["amount_approved", 10000], ["id", "b6cf5803-4f6b-4dab-bda8-2a7d3b53ef59"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "5b41f930-9a8c-463d-844d-1a23f4f1e04f"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (8.0ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "69194994-0315-497f-b21e-580be01c299a"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (12.3ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "69194994-0315-497f-b21e-580be01c299a"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "69194994-0315-497f-b21e-580be01c299a"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" DISABLE TRIGGER ALL[0m
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.0ms)[0m  [1m[34m          SELECT schemaname || '.' || tablename
          FROM pg_tables
          WHERE
            tablename !~ '_prt_' AND
             tablename <> 'schema_migrations'  AND tablename <> 'ar_internal_metadata'  AND
            schemaname = ANY (current_schemas(false))
[0m
  [1m[35m (2.4ms)[0m  [1m[34mselect table_name from information_schema.views where table_schema = 'processor_gateway_test'[0m
  [1m[35m (24.6ms)[0m  [1m[35mTRUNCATE TABLE "public"."processor_gateway_accounts", "public"."processor_gateway_raw_requests", "public"."processor_gateway_card_products", "public"."processor_gateway_transactions", "public"."processor_gateway_cards" RESTART IDENTITY CASCADE;[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" ENABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:28.445914"], ["updated_at", "2020-12-26 15:00:28.445914"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.1ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "9dfeff7ce39485d35a415c6f65b0d728"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:28.641958"], ["updated_at", "2020-12-26 15:00:28.641958"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "9a3b5421d40b"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "9a3b5421d40b"], ["card_product_id", "default-physical"], ["processor_card_id", "9a3b5421d40b"], ["pan", "4111111111138529"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:28.732013"], ["updated_at", "2020-12-26 15:00:28.732013"], ["options", "{\"marqeta_user_token\":\"fb1481067e304c387b9a43d85973aeda\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "9a3b5421d40b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (1.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "56e5038f-e22e-4351-94d8-459f01a46c45"], ["type", "authorization"], ["card_id", "9a3b5421d40b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:28.737392"], ["created_at", "2020-12-26 15:00:28.775345"], ["processor_transaction_id", "e7398eee-3ca3-4d07-814a-45c0b6721fae"], ["card_acceptor_id", "4072cb14-e40e-4ad2-979f-9da41808bcba"], ["acquirer_id", "774c8b47-fe5f-4071-9013-ddf34e29500c"], ["terminal_id", "7ea78744-f7f7-4ac4-95ff-861490c4b9f9"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.8ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "e7398eee-3ca3-4d07-814a-45c0b6721fae"], ["amount_approved", 10000], ["id", "56e5038f-e22e-4351-94d8-459f01a46c45"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:28.834842"], ["updated_at", "2020-12-26 15:00:28.834842"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "a4e3d6f602cf7ad38ec48f2725eeb707"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:28.848262"], ["updated_at", "2020-12-26 15:00:28.848262"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (1.1ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "0a1fa9567326"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "0a1fa9567326"], ["card_product_id", "default-physical"], ["processor_card_id", "0a1fa9567326"], ["pan", "4111111111147456"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:28.863806"], ["updated_at", "2020-12-26 15:00:28.863806"], ["options", "{\"marqeta_user_token\":\"cf598ae10e7656787349b90833200a05\"}"]]
  [1m[35m (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "0a1fa9567326"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "ad5862f7-df25-4ce6-914a-adeb8ee07cc5"], ["type", "authorization"], ["card_id", "0a1fa9567326"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:28.869939"], ["created_at", "2020-12-26 15:00:28.876442"], ["processor_transaction_id", "72fdc657-6a1b-4cbd-97f6-844fa5ec4a8f"], ["card_acceptor_id", "a3455912-ac2b-4246-8b38-dd521f4f981c"], ["acquirer_id", "b720b8d4-f8cd-4aeb-85b1-d908f71a6821"], ["terminal_id", "53fa675c-8665-41fb-bdf2-acf08bb8da5e"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:28.897477"], ["updated_at", "2020-12-26 15:00:28.897477"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "e4cf5fc066bfd40e775208733319ec54"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:28.908978"], ["updated_at", "2020-12-26 15:00:28.908978"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "a5940b9bc7c6"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "a5940b9bc7c6"], ["card_product_id", "default-physical"], ["processor_card_id", "a5940b9bc7c6"], ["pan", "4111111111164969"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:28.922359"], ["updated_at", "2020-12-26 15:00:28.922359"], ["options", "{\"marqeta_user_token\":\"8a762aa1735d63763273079a88c03f5b\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "a5940b9bc7c6"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "160ba34a-d584-4de9-9458-2ddc6077e0f3"], ["type", "authorization"], ["card_id", "a5940b9bc7c6"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:28.927815"], ["created_at", "2020-12-26 15:00:28.933766"], ["processor_transaction_id", "c84694f1-5fb8-42c3-b92d-10affede22b8"], ["card_acceptor_id", "69de1532-2153-43f9-b853-eca5434282d4"], ["acquirer_id", "6fa0e895-83ec-4f08-a3ab-00b8879b860d"], ["terminal_id", "9d4b25ab-9ae3-4da0-b931-a8af1cefe1a9"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.0ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "c84694f1-5fb8-42c3-b92d-10affede22b8"], ["amount_approved", 10000], ["id", "160ba34a-d584-4de9-9458-2ddc6077e0f3"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "2d1814fa-4657-4966-bfdb-6beb1dc496f5"], ["type", "capture"], ["parent_transaction_id", "160ba34a-d584-4de9-9458-2ddc6077e0f3"], ["card_id", "a5940b9bc7c6"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:28.927815"], ["created_at", "2020-12-26 15:00:28.952149"], ["processor_transaction_id", "c84694f1-5fb8-42c3-b92d-10affede22b8"], ["card_acceptor_id", "69de1532-2153-43f9-b853-eca5434282d4"], ["acquirer_id", "6fa0e895-83ec-4f08-a3ab-00b8879b860d"], ["terminal_id", "9d4b25ab-9ae3-4da0-b931-a8af1cefe1a9"]]
  [1m[35m (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.0ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "c84694f1-5fb8-42c3-b92d-10affede22b8"], ["amount_approved", 10000], ["id", "2d1814fa-4657-4966-bfdb-6beb1dc496f5"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:29.175559"], ["updated_at", "2020-12-26 15:00:29.175559"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "13950df415f02f056d5cae7a6859cb6c"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:29.187387"], ["updated_at", "2020-12-26 15:00:29.187387"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "f6e03836f838"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "f6e03836f838"], ["card_product_id", "default-physical"], ["processor_card_id", "f6e03836f838"], ["pan", "4111111111191672"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:29.202368"], ["updated_at", "2020-12-26 15:00:29.202368"], ["options", "{\"marqeta_user_token\":\"2032ae61344ac74eaf5a98463879be87\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "f6e03836f838"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "867ffd7f-123f-4269-9e08-3f26917b72ce"], ["type", "authorization"], ["card_id", "f6e03836f838"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:29.207631"], ["created_at", "2020-12-26 15:00:29.213271"], ["processor_transaction_id", "fc5b4ac3-1695-47be-a77f-053b04c508f6"], ["card_acceptor_id", "9fa3ec4c-6b07-4bc5-9a25-d63af020b199"], ["acquirer_id", "732d7cc5-2c17-430f-9b74-4bfbab3fb56a"], ["terminal_id", "cc5881df-350d-4df0-af34-4ccbcc6088eb"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:29.235704"], ["updated_at", "2020-12-26 15:00:29.235704"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "87afdda1e03dd6effd0b9e60ccdf82be"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:29.247594"], ["updated_at", "2020-12-26 15:00:29.247594"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "56d461e3c862"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "56d461e3c862"], ["card_product_id", "default-physical"], ["processor_card_id", "56d461e3c862"], ["pan", "4111111111191289"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:29.261052"], ["updated_at", "2020-12-26 15:00:29.261052"], ["options", "{\"marqeta_user_token\":\"a7d245c72e292abb95f75ef2b35fdabe\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "56d461e3c862"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "51752515-721a-4ef1-856a-836be6fd79aa"], ["type", "authorization"], ["card_id", "56d461e3c862"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:29.266511"], ["created_at", "2020-12-26 15:00:29.272315"], ["processor_transaction_id", "7d2aaffb-3978-4130-a892-f0a76ba7a3ac"], ["card_acceptor_id", "9682702e-05c9-4fa9-926d-99e00734cf0a"], ["acquirer_id", "d6bc50b4-128d-4433-9660-7eb3b405b06c"], ["terminal_id", "57412c60-4c76-4411-aef9-0f0664f0cbee"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.8ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "7d2aaffb-3978-4130-a892-f0a76ba7a3ac"], ["amount_approved", 10000], ["id", "51752515-721a-4ef1-856a-836be6fd79aa"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:29.302265"], ["updated_at", "2020-12-26 15:00:29.302265"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.2ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "957d1cb215a5ff23638711eefc5abf74"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:29.318363"], ["updated_at", "2020-12-26 15:00:29.318363"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "ba36e9e493df"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "ba36e9e493df"], ["card_product_id", "default-physical"], ["processor_card_id", "ba36e9e493df"], ["pan", "4111111111105418"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:29.334180"], ["updated_at", "2020-12-26 15:00:29.334180"], ["options", "{\"marqeta_user_token\":\"063f9ab585bb8f913b6df3db09e7c8f5\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "ba36e9e493df"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (1.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (1.1ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "da32be44-32ee-4b9d-8f67-9009c4bb50bf"], ["type", "authorization"], ["card_id", "ba36e9e493df"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:29.339156"], ["created_at", "2020-12-26 15:00:29.345363"], ["processor_transaction_id", "7ba38a81-aac9-4e08-acdb-eeb85cd6e36d"], ["card_acceptor_id", "12f9ee38-689c-4c51-b9fd-2d3c9223ee51"], ["acquirer_id", "15aab3af-4a93-47e8-b296-7c859a2de095"], ["terminal_id", "a7b34971-6917-401f-82e4-78f609048ae5"]]
  [1m[35m (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:29.375622"], ["updated_at", "2020-12-26 15:00:29.375622"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "9f7d2cde3753235952518c4c4254d6a3"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:29.388554"], ["updated_at", "2020-12-26 15:00:29.388554"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "a7644b6cd43e"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "a7644b6cd43e"], ["card_product_id", "default-physical"], ["processor_card_id", "a7644b6cd43e"], ["pan", "4111111111188289"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:29.402078"], ["updated_at", "2020-12-26 15:00:29.402078"], ["options", "{\"marqeta_user_token\":\"68c3c4d1fce66e60a64ca549a696fe5a\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "a7644b6cd43e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "3c29a8f2-9c26-4c47-a3b7-c174f315d857"], ["type", "refund"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[37mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "a7644b6cd43e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "3c29a8f2-9c26-4c47-a3b7-c174f315d857"], ["type", "refund"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "dcb1b5b6-454d-4a87-819d-356fc9854273"], ["type", "refund"], ["card_id", "a7644b6cd43e"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:29.407159"], ["created_at", "2020-12-26 15:00:29.418131"], ["processor_transaction_id", "3c29a8f2-9c26-4c47-a3b7-c174f315d857"], ["card_acceptor_id", "07046fbe-b964-4f43-a052-1b056e376e7e"], ["acquirer_id", "a02a543e-e23c-480f-96db-a9776c39c335"], ["terminal_id", "4b4b6ab3-7f38-41db-b6ad-399961e65ff1"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "3c29a8f2-9c26-4c47-a3b7-c174f315d857"], ["amount_approved", 10000], ["id", "dcb1b5b6-454d-4a87-819d-356fc9854273"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:29.439458"], ["updated_at", "2020-12-26 15:00:29.439458"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "bd90ace6d919c08f670e7cbf2faaa8a3"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:29.450140"], ["updated_at", "2020-12-26 15:00:29.450140"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "570cd02c1ead"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "570cd02c1ead"], ["card_product_id", "default-physical"], ["processor_card_id", "570cd02c1ead"], ["pan", "4111111111179238"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:29.462555"], ["updated_at", "2020-12-26 15:00:29.462555"], ["options", "{\"marqeta_user_token\":\"b2d530f59d39d7e10b8cc74844407cef\"}"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "570cd02c1ead"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "dd242523-1922-48e0-be59-0b35a77722b4"], ["type", "authorization"], ["card_id", "570cd02c1ead"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 15:00:29.471278"], ["processor_transaction_id", "bf4a3d962d8b85d1d7c2010a5dba1bea"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "570cd02c1ead"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "bf4a3d962d8b85d1d7c2010a5dba1bea"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "dd242523-1922-48e0-be59-0b35a77722b4"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "fa078650-d25e-4ab8-81a0-8fb32aa368b9"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "2344e9bc-ad15-4bd2-8dcc-e15ed6065e1c"], ["type", "capture"], ["parent_transaction_id", "dd242523-1922-48e0-be59-0b35a77722b4"], ["card_id", "570cd02c1ead"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:29.490393"], ["created_at", "2020-12-26 15:00:29.501652"], ["processor_transaction_id", "fa078650-d25e-4ab8-81a0-8fb32aa368b9"], ["card_acceptor_id", "7526f5dc-11ff-40fe-8f22-2134b06e8d90"], ["acquirer_id", "38fde3f8-1fef-4cb8-b918-638a4697ac29"], ["terminal_id", "ca49d19b-2ffd-44c4-8119-f51fc89fe928"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "dd242523-1922-48e0-be59-0b35a77722b4"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.9ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "fa078650-d25e-4ab8-81a0-8fb32aa368b9"], ["amount_approved", 10000], ["id", "2344e9bc-ad15-4bd2-8dcc-e15ed6065e1c"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:00:29.526755"], ["updated_at", "2020-12-26 15:00:29.526755"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "2ac740fd84224c89941dd5b3c1d59a1f"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:00:29.537014"], ["updated_at", "2020-12-26 15:00:29.537014"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "3d8e443b421b"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "3d8e443b421b"], ["card_product_id", "default-physical"], ["processor_card_id", "3d8e443b421b"], ["pan", "4111111111186950"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:00:29.551131"], ["updated_at", "2020-12-26 15:00:29.551131"], ["options", "{\"marqeta_user_token\":\"c8a23e5181fbd590a0648a3616ae9463\"}"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "3d8e443b421b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["type", "authorization"], ["card_id", "3d8e443b421b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 15:00:29.560982"], ["processor_transaction_id", "0e4606e5d0456ebd06bcad46bb4d0e3d"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (1.3ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "3d8e443b421b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (0.2ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "3d8e443b421b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "3d8e443b421b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (1.1ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "3d8e443b421b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "0e4606e5d0456ebd06bcad46bb4d0e3d"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "0e4606e5d0456ebd06bcad46bb4d0e3d"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.1ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "0e4606e5d0456ebd06bcad46bb4d0e3d"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "0e4606e5d0456ebd06bcad46bb4d0e3d"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "381fc70e-b7e9-4801-91a1-dd1f2ecf250f"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "0881d434-f3e5-4acf-a6fa-1127bc301cba"], ["type", "capture"], ["parent_transaction_id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["card_id", "3d8e443b421b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:00:29.579059"], ["created_at", "2020-12-26 15:00:29.605647"], ["processor_transaction_id", "381fc70e-b7e9-4801-91a1-dd1f2ecf250f"], ["card_acceptor_id", "c3bc4041-521f-4674-a1f2-a943549f02e8"], ["acquirer_id", "a4f2f460-a2d1-4cff-8ed1-88060a90a7bc"], ["terminal_id", "acdf15c0-69a4-4597-a530-f5b3e2c75fef"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.4ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.0ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.4ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "338059a6-8100-4bb3-8357-f5cd1ca93274"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "381fc70e-b7e9-4801-91a1-dd1f2ecf250f"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (1.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.6ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "381fc70e-b7e9-4801-91a1-dd1f2ecf250f"], ["amount_approved", 10000], ["id", "0881d434-f3e5-4acf-a6fa-1127bc301cba"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Exists? (8.7ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "381fc70e-b7e9-4801-91a1-dd1f2ecf250f"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (8.8ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "381fc70e-b7e9-4801-91a1-dd1f2ecf250f"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" DISABLE TRIGGER ALL[0m
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.4ms)[0m  [1m[34m          SELECT schemaname || '.' || tablename
          FROM pg_tables
          WHERE
            tablename !~ '_prt_' AND
             tablename <> 'schema_migrations'  AND tablename <> 'ar_internal_metadata'  AND
            schemaname = ANY (current_schemas(false))
[0m
  [1m[35m (1.4ms)[0m  [1m[34mselect table_name from information_schema.views where table_schema = 'processor_gateway_test'[0m
  [1m[35m (25.7ms)[0m  [1m[35mTRUNCATE TABLE "public"."processor_gateway_accounts", "public"."processor_gateway_raw_requests", "public"."processor_gateway_card_products", "public"."processor_gateway_transactions", "public"."processor_gateway_cards" RESTART IDENTITY CASCADE;[0m
  [1m[35m (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:41.893519"], ["updated_at", "2020-12-26 15:04:41.893519"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.2ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "3195de9b541fdbaecf153ade992a1fdf"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.087528"], ["updated_at", "2020-12-26 15:04:42.087528"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "517d5eb344c4"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "517d5eb344c4"], ["card_product_id", "default-physical"], ["processor_card_id", "517d5eb344c4"], ["pan", "4111111111121546"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.172570"], ["updated_at", "2020-12-26 15:04:42.172570"], ["options", "{\"marqeta_user_token\":\"97725b72658f0f2d087228f706c0bc60\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "517d5eb344c4"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "548f42be-04f1-48d4-9193-2c137361b25d"], ["type", "authorization"], ["card_id", "517d5eb344c4"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.177282"], ["created_at", "2020-12-26 15:04:42.206681"], ["processor_transaction_id", "50f2a1a2-d6d2-4942-9ca7-a82a1e3f41d1"], ["card_acceptor_id", "4ca80847-c53a-4801-88ef-6ce31d7be29f"], ["acquirer_id", "36e068e4-06f5-4525-923c-b95489e0dfa0"], ["terminal_id", "02a7ea62-91c0-40cd-9267-15f24723d03f"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.8ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "50f2a1a2-d6d2-4942-9ca7-a82a1e3f41d1"], ["amount_approved", 10000], ["id", "548f42be-04f1-48d4-9193-2c137361b25d"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.260245"], ["updated_at", "2020-12-26 15:04:42.260245"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "fb609924c6e2c9228cf0be94aa3822ac"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.270844"], ["updated_at", "2020-12-26 15:04:42.270844"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "5dc0387fab67"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "5dc0387fab67"], ["card_product_id", "default-physical"], ["processor_card_id", "5dc0387fab67"], ["pan", "4111111111102434"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.285382"], ["updated_at", "2020-12-26 15:04:42.285382"], ["options", "{\"marqeta_user_token\":\"ed7d894dd0b9ad6f589b985b01a4c8f4\"}"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "5dc0387fab67"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (1.1ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "bf64627f-e493-4927-b2ca-87d6725d7c95"], ["type", "authorization"], ["card_id", "5dc0387fab67"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.290605"], ["created_at", "2020-12-26 15:04:42.295686"], ["processor_transaction_id", "2e36a9e1-0aca-455e-9a46-bc6bf5dbb77b"], ["card_acceptor_id", "0303cf38-36b7-4294-8b6b-853a75a3f5fd"], ["acquirer_id", "2fc8c3c9-7785-4430-bfd9-5c3010202c26"], ["terminal_id", "f93ee86d-b7f8-459b-a9d1-dfc56300dd5e"]]
  [1m[35m (0.9ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.317636"], ["updated_at", "2020-12-26 15:04:42.317636"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "960f80824013edc59b9fa3bfed5e93f7"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.328915"], ["updated_at", "2020-12-26 15:04:42.328915"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "eb8457ef1597"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (2.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "eb8457ef1597"], ["card_product_id", "default-physical"], ["processor_card_id", "eb8457ef1597"], ["pan", "4111111111124823"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.344968"], ["updated_at", "2020-12-26 15:04:42.344968"], ["options", "{\"marqeta_user_token\":\"af6650e37b0276861f11ae5742034392\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "eb8457ef1597"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "9657c0ce-0398-429d-8f36-107ea93db03a"], ["type", "authorization"], ["card_id", "eb8457ef1597"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.352403"], ["created_at", "2020-12-26 15:04:42.359036"], ["processor_transaction_id", "bb331742-83c0-4d71-92cb-4aac17369863"], ["card_acceptor_id", "bf2b01e0-daeb-4021-a209-bf562c9f4d99"], ["acquirer_id", "7dce821c-4fd6-4dbb-b620-34c057383b94"], ["terminal_id", "e0680dfd-0682-4635-b7a6-05773f8f1cb4"]]
  [1m[35m (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.8ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "bb331742-83c0-4d71-92cb-4aac17369863"], ["amount_approved", 10000], ["id", "9657c0ce-0398-429d-8f36-107ea93db03a"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "873ce96e-1eaf-49cc-8e1e-2412fddd8517"], ["type", "capture"], ["parent_transaction_id", "9657c0ce-0398-429d-8f36-107ea93db03a"], ["card_id", "eb8457ef1597"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.352403"], ["created_at", "2020-12-26 15:04:42.375487"], ["processor_transaction_id", "bb331742-83c0-4d71-92cb-4aac17369863"], ["card_acceptor_id", "bf2b01e0-daeb-4021-a209-bf562c9f4d99"], ["acquirer_id", "7dce821c-4fd6-4dbb-b620-34c057383b94"], ["terminal_id", "e0680dfd-0682-4635-b7a6-05773f8f1cb4"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.9ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "bb331742-83c0-4d71-92cb-4aac17369863"], ["amount_approved", 10000], ["id", "873ce96e-1eaf-49cc-8e1e-2412fddd8517"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.404898"], ["updated_at", "2020-12-26 15:04:42.404898"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "2ff3c1a365e433f2ab285a5c73ec6256"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.417134"], ["updated_at", "2020-12-26 15:04:42.417134"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "cc418c91cd52"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "cc418c91cd52"], ["card_product_id", "default-physical"], ["processor_card_id", "cc418c91cd52"], ["pan", "4111111111144538"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.431361"], ["updated_at", "2020-12-26 15:04:42.431361"], ["options", "{\"marqeta_user_token\":\"5805de1c5d3dc025e497247e67d92845\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "cc418c91cd52"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "fe905963-4043-4dd7-a89b-a4fa15c55db6"], ["type", "authorization"], ["card_id", "cc418c91cd52"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.435606"], ["created_at", "2020-12-26 15:04:42.440966"], ["processor_transaction_id", "9bb5a510-5d21-4bf5-8f07-2b5814222b46"], ["card_acceptor_id", "b687463f-47c8-4933-9559-1bb89a5aeabe"], ["acquirer_id", "6b473884-e952-403e-84a5-0c541afa6c54"], ["terminal_id", "fef3d75f-8157-4f73-a5aa-b745ccd35fbd"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (1.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.473165"], ["updated_at", "2020-12-26 15:04:42.473165"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "b01037023b613dc6bc4d5fd8b36d4bc3"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.493623"], ["updated_at", "2020-12-26 15:04:42.493623"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "3f69f001aa15"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (1.2ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "3f69f001aa15"], ["card_product_id", "default-physical"], ["processor_card_id", "3f69f001aa15"], ["pan", "4111111111110469"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.515288"], ["updated_at", "2020-12-26 15:04:42.515288"], ["options", "{\"marqeta_user_token\":\"61c7b587d8b435cddb8a437d9992113c\"}"]]
  [1m[35m (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "3f69f001aa15"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.1ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "141d9777-998d-42fe-809d-fe8e4ba61d46"], ["type", "authorization"], ["card_id", "3f69f001aa15"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.523587"], ["created_at", "2020-12-26 15:04:42.545049"], ["processor_transaction_id", "a2f5fcab-1481-4888-a65b-4b1a298699e0"], ["card_acceptor_id", "0f021ca0-7702-4cc6-b4be-fc9f7ce012bb"], ["acquirer_id", "6dd5de91-1047-49a0-ae3d-5e07cd57186a"], ["terminal_id", "f07f7811-beae-47e2-b15a-58d8e8a24616"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (1.0ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.3ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "a2f5fcab-1481-4888-a65b-4b1a298699e0"], ["amount_approved", 10000], ["id", "141d9777-998d-42fe-809d-fe8e4ba61d46"]]
  [1m[35m (53.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.737514"], ["updated_at", "2020-12-26 15:04:42.737514"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "204b50a250d7acab1e214df0b43618c8"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.751642"], ["updated_at", "2020-12-26 15:04:42.751642"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "c59832c52b69"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "c59832c52b69"], ["card_product_id", "default-physical"], ["processor_card_id", "c59832c52b69"], ["pan", "4111111111189833"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.765398"], ["updated_at", "2020-12-26 15:04:42.765398"], ["options", "{\"marqeta_user_token\":\"fe1694be9ee769cb73cca5c1d97d094c\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "c59832c52b69"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.2ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (1.4ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "df90c96b-f3ba-45e6-9d6e-60731b0a34fb"], ["type", "authorization"], ["card_id", "c59832c52b69"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.771266"], ["created_at", "2020-12-26 15:04:42.778906"], ["processor_transaction_id", "a2e0e60e-30a6-4d12-98b5-8fa145f58233"], ["card_acceptor_id", "2259ac9a-8a32-46cf-9f9b-37ff7fec4ce1"], ["acquirer_id", "ff35ae9e-8718-4f9d-8c33-4339e8a95c2e"], ["terminal_id", "d578331f-d991-4b25-b7cb-48ce87d4d53a"]]
  [1m[35m (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.800622"], ["updated_at", "2020-12-26 15:04:42.800622"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "a3e84f06026e4220a132c6740b505252"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.813587"], ["updated_at", "2020-12-26 15:04:42.813587"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "de9a305983f0"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "de9a305983f0"], ["card_product_id", "default-physical"], ["processor_card_id", "de9a305983f0"], ["pan", "4111111111159957"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.826894"], ["updated_at", "2020-12-26 15:04:42.826894"], ["options", "{\"marqeta_user_token\":\"70e8f6629685aa86edfe27e0ea768151\"}"]]
  [1m[35m (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "de9a305983f0"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "ec46d788-df82-4479-aeb9-14eb34c986af"], ["type", "refund"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.8ms)[0m  [1m[37mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "de9a305983f0"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "ec46d788-df82-4479-aeb9-14eb34c986af"], ["type", "refund"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (1.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "6e3d3c1a-b049-43c8-8143-cd5fb20c2204"], ["type", "refund"], ["card_id", "de9a305983f0"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.835408"], ["created_at", "2020-12-26 15:04:42.849282"], ["processor_transaction_id", "ec46d788-df82-4479-aeb9-14eb34c986af"], ["card_acceptor_id", "7f61805e-f897-424d-b4e6-e18ed59771af"], ["acquirer_id", "9c6b7336-ff03-4443-b99c-8b939d9e4630"], ["terminal_id", "cbba8212-a50b-45b9-bbdb-8efbec57f033"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.8ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "ec46d788-df82-4479-aeb9-14eb34c986af"], ["amount_approved", 10000], ["id", "6e3d3c1a-b049-43c8-8143-cd5fb20c2204"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.875064"], ["updated_at", "2020-12-26 15:04:42.875064"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "33f2a32bf33cc8bea64ae37cc910cb6b"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:42.888141"], ["updated_at", "2020-12-26 15:04:42.888141"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "8ce23a1f8bb8"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "8ce23a1f8bb8"], ["card_product_id", "default-physical"], ["processor_card_id", "8ce23a1f8bb8"], ["pan", "4111111111129553"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:42.903889"], ["updated_at", "2020-12-26 15:04:42.903889"], ["options", "{\"marqeta_user_token\":\"236efcb81b996c23c20128e2874480ba\"}"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "8ce23a1f8bb8"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (1.0ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "10759259-b1dd-4b33-8d27-8d254bd2f7f3"], ["type", "authorization"], ["card_id", "8ce23a1f8bb8"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 15:04:42.914563"], ["processor_transaction_id", "eac3c0d3b52e021167e05c19bfb39a9f"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "8ce23a1f8bb8"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "eac3c0d3b52e021167e05c19bfb39a9f"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "10759259-b1dd-4b33-8d27-8d254bd2f7f3"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "7fe92351-fb3f-4aaf-a988-e756a43fa945"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "eca5c6e3-4dbb-4f15-b55d-4351bf68df2c"], ["type", "capture"], ["parent_transaction_id", "10759259-b1dd-4b33-8d27-8d254bd2f7f3"], ["card_id", "8ce23a1f8bb8"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:42.957195"], ["created_at", "2020-12-26 15:04:42.970020"], ["processor_transaction_id", "7fe92351-fb3f-4aaf-a988-e756a43fa945"], ["card_acceptor_id", "579943fe-9d8f-42f4-9163-d1c081362f6b"], ["acquirer_id", "73710946-f1ae-4cb9-ada7-fc997a51d1a9"], ["terminal_id", "62e5b396-f8e1-40ee-ba79-9f11843bb7e8"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "10759259-b1dd-4b33-8d27-8d254bd2f7f3"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.6ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "7fe92351-fb3f-4aaf-a988-e756a43fa945"], ["amount_approved", 10000], ["id", "eca5c6e3-4dbb-4f15-b55d-4351bf68df2c"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:04:42.997763"], ["updated_at", "2020-12-26 15:04:42.997763"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "c45d6f03eb9c518531c326029ae9a05f"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:04:43.011435"], ["updated_at", "2020-12-26 15:04:43.011435"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (2.0ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (3.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "18debf1a7205"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (5.2ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "18debf1a7205"], ["card_product_id", "default-physical"], ["processor_card_id", "18debf1a7205"], ["pan", "4111111111143580"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:04:43.041170"], ["updated_at", "2020-12-26 15:04:43.041170"], ["options", "{\"marqeta_user_token\":\"383f9a7912e92eed9c1009e89661b2ec\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "18debf1a7205"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["type", "authorization"], ["card_id", "18debf1a7205"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 15:04:43.058988"], ["processor_transaction_id", "e39a5022db5646a3c9b85cc91c1d25ea"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (1.1ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "18debf1a7205"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (1.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "18debf1a7205"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "18debf1a7205"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "e39a5022db5646a3c9b85cc91c1d25ea"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "e39a5022db5646a3c9b85cc91c1d25ea"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (2.0ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "18debf1a7205"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.0ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "e39a5022db5646a3c9b85cc91c1d25ea"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.9ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "51fd2a37-395c-49b0-a68b-3196d0a20c48"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (1.1ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "a5ee229c-9831-4370-a012-ec3a1f2da588"], ["type", "capture"], ["parent_transaction_id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["card_id", "18debf1a7205"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:04:43.078854"], ["created_at", "2020-12-26 15:04:43.106629"], ["processor_transaction_id", "51fd2a37-395c-49b0-a68b-3196d0a20c48"], ["card_acceptor_id", "ea3e4241-9fcb-429f-8c1c-2ffa09cae022"], ["acquirer_id", "427453c6-6ffa-4d55-bd8e-b073f473a81a"], ["terminal_id", "ea71fcd9-8934-4c0c-9421-e9e16ff01446"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.9ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "e39a5022db5646a3c9b85cc91c1d25ea"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.9ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "51fd2a37-395c-49b0-a68b-3196d0a20c48"], ["amount_approved", 10000], ["id", "a5ee229c-9831-4370-a012-ec3a1f2da588"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Exists? (9.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "51fd2a37-395c-49b0-a68b-3196d0a20c48"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "ff8eb74c-f123-41f2-9918-c97d8772951e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (13.1ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "51fd2a37-395c-49b0-a68b-3196d0a20c48"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mProcessorGateway::Transaction Exists? (8.0ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "51fd2a37-395c-49b0-a68b-3196d0a20c48"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" DISABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" DISABLE TRIGGER ALL[0m
  [1m[35m (3.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.5ms)[0m  [1m[34m          SELECT schemaname || '.' || tablename
          FROM pg_tables
          WHERE
            tablename !~ '_prt_' AND
             tablename <> 'schema_migrations'  AND tablename <> 'ar_internal_metadata'  AND
            schemaname = ANY (current_schemas(false))
[0m
  [1m[35m (2.2ms)[0m  [1m[34mselect table_name from information_schema.views where table_schema = 'processor_gateway_test'[0m
  [1m[35m (26.1ms)[0m  [1m[35mTRUNCATE TABLE "public"."processor_gateway_accounts", "public"."processor_gateway_raw_requests", "public"."processor_gateway_card_products", "public"."processor_gateway_transactions", "public"."processor_gateway_cards" RESTART IDENTITY CASCADE;[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_accounts" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_raw_requests" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_card_products" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_transactions" ENABLE TRIGGER ALL;ALTER TABLE "processor_gateway_cards" ENABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:30.253391"], ["updated_at", "2020-12-26 15:08:30.253391"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (1.3ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "a230382ebb8225f3c20cb15d9c0558a8"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:30.460275"], ["updated_at", "2020-12-26 15:08:30.460275"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (1.0ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "c6c16c1ead12"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "c6c16c1ead12"], ["card_product_id", "default-physical"], ["processor_card_id", "c6c16c1ead12"], ["pan", "4111111111130051"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:30.549853"], ["updated_at", "2020-12-26 15:08:30.549853"], ["options", "{\"marqeta_user_token\":\"f12862270e4b42d40cc6517e32bdd4ae\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "c6c16c1ead12"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "dfed25a0-891a-4621-a7c5-66d4994ccec2"], ["type", "authorization"], ["card_id", "c6c16c1ead12"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.554479"], ["created_at", "2020-12-26 15:08:30.587294"], ["processor_transaction_id", "6733b89d-74f5-452e-a62d-96d27e1a75b9"], ["card_acceptor_id", "9b15ba49-8e06-44b0-9423-a27d50aeeec4"], ["acquirer_id", "2a7a255e-ace5-4e50-8caa-c038eeb90a6f"], ["terminal_id", "8ff76b7b-ea47-4699-b2d3-cb25b17378c5"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (3.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.1ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "6733b89d-74f5-452e-a62d-96d27e1a75b9"], ["amount_approved", 10000], ["id", "dfed25a0-891a-4621-a7c5-66d4994ccec2"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:30.665523"], ["updated_at", "2020-12-26 15:08:30.665523"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "132fa6adfd8d234acb9d9609593ae617"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:30.677420"], ["updated_at", "2020-12-26 15:08:30.677420"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "cdafdddca151"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "cdafdddca151"], ["card_product_id", "default-physical"], ["processor_card_id", "cdafdddca151"], ["pan", "4111111111198826"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:30.690426"], ["updated_at", "2020-12-26 15:08:30.690426"], ["options", "{\"marqeta_user_token\":\"440cf9aad32a4d704c41c3492b469a85\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "cdafdddca151"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "d8e1f5b9-e6a5-4ea6-9f04-2e263af81ee2"], ["type", "authorization"], ["card_id", "cdafdddca151"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.694736"], ["created_at", "2020-12-26 15:08:30.701135"], ["processor_transaction_id", "19b6785d-a6c0-48e4-a409-53bb0bfba019"], ["card_acceptor_id", "37bba1c2-82d5-4bef-b209-6d5eab941859"], ["acquirer_id", "cf92896d-c79d-437e-913f-3172851d1828"], ["terminal_id", "03bcea3b-c8a9-45a4-8c43-04792635ad43"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:30.722735"], ["updated_at", "2020-12-26 15:08:30.722735"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "3fb21e15d945b9bf170b5f8b8c56398d"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:30.735396"], ["updated_at", "2020-12-26 15:08:30.735396"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "c014e814cf1b"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "c014e814cf1b"], ["card_product_id", "default-physical"], ["processor_card_id", "c014e814cf1b"], ["pan", "4111111111122648"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:30.749159"], ["updated_at", "2020-12-26 15:08:30.749159"], ["options", "{\"marqeta_user_token\":\"6db9f90844c54ee611f4cd1906244a33\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "c014e814cf1b"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "c8798515-8563-4d4f-99c8-6261815840ab"], ["type", "authorization"], ["card_id", "c014e814cf1b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.754216"], ["created_at", "2020-12-26 15:08:30.760906"], ["processor_transaction_id", "618cecb8-6b22-4d63-8f63-8f8a691cd319"], ["card_acceptor_id", "a860e626-6af3-4525-a0ec-d5988e506b04"], ["acquirer_id", "de9b0b64-c121-4d4e-a1c3-ac939069ddb3"], ["terminal_id", "6f2588bf-99a9-4448-9b05-8ba4df09c347"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.6ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "618cecb8-6b22-4d63-8f63-8f8a691cd319"], ["amount_approved", 10000], ["id", "c8798515-8563-4d4f-99c8-6261815840ab"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (1.2ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "adefa1dc-7eb1-4079-b2f5-ca39e996753b"], ["type", "capture"], ["parent_transaction_id", "c8798515-8563-4d4f-99c8-6261815840ab"], ["card_id", "c014e814cf1b"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.754216"], ["created_at", "2020-12-26 15:08:30.780129"], ["processor_transaction_id", "618cecb8-6b22-4d63-8f63-8f8a691cd319"], ["card_acceptor_id", "a860e626-6af3-4525-a0ec-d5988e506b04"], ["acquirer_id", "de9b0b64-c121-4d4e-a1c3-ac939069ddb3"], ["terminal_id", "6f2588bf-99a9-4448-9b05-8ba4df09c347"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "618cecb8-6b22-4d63-8f63-8f8a691cd319"], ["amount_approved", 10000], ["id", "adefa1dc-7eb1-4079-b2f5-ca39e996753b"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:30.809695"], ["updated_at", "2020-12-26 15:08:30.809695"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "b7b7eb3cd3c16968a28003ef61218145"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:30.823353"], ["updated_at", "2020-12-26 15:08:30.823353"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "aa6676219edc"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "aa6676219edc"], ["card_product_id", "default-physical"], ["processor_card_id", "aa6676219edc"], ["pan", "4111111111118935"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:30.840700"], ["updated_at", "2020-12-26 15:08:30.840700"], ["options", "{\"marqeta_user_token\":\"bafd87ad2009eed92e15bb537ca76a7e\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "aa6676219edc"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "8fee9da8-a9e4-4f04-be7c-5409cd09a723"], ["type", "authorization"], ["card_id", "aa6676219edc"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.846006"], ["created_at", "2020-12-26 15:08:30.852925"], ["processor_transaction_id", "50645481-ae53-4904-9ab2-08556c41607b"], ["card_acceptor_id", "581c121c-8a78-42a5-807e-ca3dd51ee01a"], ["acquirer_id", "b453df8d-2bc4-4da1-a587-44f3d791fc29"], ["terminal_id", "77a00d91-8902-43a8-a501-ae1fe7646b76"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:30.876708"], ["updated_at", "2020-12-26 15:08:30.876708"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "72320a929ae75025460a4455b975032a"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:30.891053"], ["updated_at", "2020-12-26 15:08:30.891053"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "a4917b2d48a6"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "a4917b2d48a6"], ["card_product_id", "default-physical"], ["processor_card_id", "a4917b2d48a6"], ["pan", "4111111111139312"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:30.908234"], ["updated_at", "2020-12-26 15:08:30.908234"], ["options", "{\"marqeta_user_token\":\"790e946d0ffc5cdfd45a1aca03c2e009\"}"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "a4917b2d48a6"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "fe0950d8-2e1c-491b-86fa-a63e14df6a1e"], ["type", "authorization"], ["card_id", "a4917b2d48a6"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.913669"], ["created_at", "2020-12-26 15:08:30.920733"], ["processor_transaction_id", "efef1257-4703-433c-8ce3-5dfee07f3e7b"], ["card_acceptor_id", "62f2ce2b-1f97-4e8f-a79e-21ed7a0a31c2"], ["acquirer_id", "9763bf4d-3c97-49b2-ba70-e3088261ea37"], ["terminal_id", "ab46bc9a-c320-41f2-b3cb-aab40c750147"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.8ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "efef1257-4703-433c-8ce3-5dfee07f3e7b"], ["amount_approved", 10000], ["id", "fe0950d8-2e1c-491b-86fa-a63e14df6a1e"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:30.956711"], ["updated_at", "2020-12-26 15:08:30.956711"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "26310cb618d664b91a22db9f358b70c2"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:30.970691"], ["updated_at", "2020-12-26 15:08:30.970691"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "e48b8009d04e"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "e48b8009d04e"], ["card_product_id", "default-physical"], ["processor_card_id", "e48b8009d04e"], ["pan", "4111111111134496"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:30.985703"], ["updated_at", "2020-12-26 15:08:30.985703"], ["options", "{\"marqeta_user_token\":\"3e4ab6d2585c0ba7b8a0f92b8ff36981\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "e48b8009d04e"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."type" = $1 AND "processor_gateway_transactions"."processor_transaction_id" IS NULL ORDER BY "processor_gateway_transactions"."created_at" DESC LIMIT $2[0m  [["type", "authorization"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "387d1d4e-be51-4abd-b23d-c08fc355d7c6"], ["type", "authorization"], ["card_id", "e48b8009d04e"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:30.991042"], ["created_at", "2020-12-26 15:08:30.998080"], ["processor_transaction_id", "47898d7b-b8b6-4089-b97e-2b5ddf7453c7"], ["card_acceptor_id", "7759e114-8ddd-487d-b3c0-f0466843fe7d"], ["acquirer_id", "0f77da66-6ba4-494a-abb1-cbcd5172a7ba"], ["terminal_id", "7cc2b45f-a320-474a-beef-7eeac1d0a18b"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.6ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:31.019711"], ["updated_at", "2020-12-26 15:08:31.019711"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "72847327f6fdf821669d8e83f7ab1856"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:31.030098"], ["updated_at", "2020-12-26 15:08:31.030098"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.4ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "c1e15013cdb9"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "c1e15013cdb9"], ["card_product_id", "default-physical"], ["processor_card_id", "c1e15013cdb9"], ["pan", "4111111111155014"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:31.042937"], ["updated_at", "2020-12-26 15:08:31.042937"], ["options", "{\"marqeta_user_token\":\"b0b9e020cf5087041965f3e461912a53\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "c1e15013cdb9"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "31e4e176-7618-4788-8aa1-1be3dd555c43"], ["type", "refund"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "c1e15013cdb9"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "31e4e176-7618-4788-8aa1-1be3dd555c43"], ["type", "refund"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14) RETURNING "id"[0m  [["id", "cfea8930-c190-4ad5-a978-f8d893474fb6"], ["type", "refund"], ["card_id", "c1e15013cdb9"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:31.047356"], ["created_at", "2020-12-26 15:08:31.059314"], ["processor_transaction_id", "31e4e176-7618-4788-8aa1-1be3dd555c43"], ["card_acceptor_id", "e21f1021-ab8e-439d-8352-f3c21e569049"], ["acquirer_id", "090155ac-0ed3-4856-8ea2-6ff3caae439f"], ["terminal_id", "4e87185f-1b2f-4557-8a0c-1ae4e7048692"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.9ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "31e4e176-7618-4788-8aa1-1be3dd555c43"], ["amount_approved", 10000], ["id", "cfea8930-c190-4ad5-a978-f8d893474fb6"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:31.080992"], ["updated_at", "2020-12-26 15:08:31.080992"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "e1bf6a064d306f560e8025258ad8b6c3"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:31.094193"], ["updated_at", "2020-12-26 15:08:31.094193"]]
  [1m[35m (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "fd85b43b2839"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "fd85b43b2839"], ["card_product_id", "default-physical"], ["processor_card_id", "fd85b43b2839"], ["pan", "4111111111139917"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:31.116060"], ["updated_at", "2020-12-26 15:08:31.116060"], ["options", "{\"marqeta_user_token\":\"e6a53f824be2091e4c230effaced2356\"}"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "fd85b43b2839"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "1e47aca1-94aa-46e8-8d6b-7836f07723ce"], ["type", "authorization"], ["card_id", "fd85b43b2839"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 15:08:31.125247"], ["processor_transaction_id", "4a30c0695dda82bc8a65df54f5d85170"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[36mProcessorGateway::Card Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "fd85b43b2839"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "4a30c0695dda82bc8a65df54f5d85170"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "1e47aca1-94aa-46e8-8d6b-7836f07723ce"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "c085478b-06fc-43b6-a11f-69ec715643df"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "59fabd19-806e-4bda-ae2c-c00d585e66af"], ["type", "capture"], ["parent_transaction_id", "1e47aca1-94aa-46e8-8d6b-7836f07723ce"], ["card_id", "fd85b43b2839"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:31.146840"], ["created_at", "2020-12-26 15:08:31.158661"], ["processor_transaction_id", "c085478b-06fc-43b6-a11f-69ec715643df"], ["card_acceptor_id", "5f160c8e-2462-4e74-8331-707357007bc9"], ["acquirer_id", "731287d6-d1b5-46c7-8a6c-fb42d81cb044"], ["terminal_id", "a7b182a2-a87b-4df6-837b-4868550882c0"]]
  [1m[35m (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "1e47aca1-94aa-46e8-8d6b-7836f07723ce"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (0.7ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "c085478b-06fc-43b6-a11f-69ec715643df"], ["amount_approved", 10000], ["id", "59fabd19-806e-4bda-ae2c-c00d585e66af"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "processor_gateway_transactions"[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Create (0.7ms)[0m  [1m[32mINSERT INTO "processor_gateway_accounts" ("id", "processor", "options", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["id", "simulator"], ["processor", "bogus"], ["options", "{}"], ["created_at", "2020-12-26 15:08:31.186985"], ["updated_at", "2020-12-26 15:08:31.186985"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Account Load (0.5ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Account Load (0.8ms)[0m  [1m[34mSELECT "processor_gateway_accounts".* FROM "processor_gateway_accounts" WHERE "processor_gateway_accounts"."id" = $1 LIMIT $2[0m  [["id", "simulator"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_card_products" ("id", "account_id", "processor_card_product_id", "payment_instrument_type", "accepted_currencies", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["id", "default-physical"], ["account_id", "simulator"], ["processor_card_product_id", "35695a545a51b7db957c8dc274b7e8db"], ["payment_instrument_type", "physical"], ["accepted_currencies", "{CAD}"], ["created_at", "2020-12-26 15:08:31.199825"], ["updated_at", "2020-12-26 15:08:31.199825"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::CardProduct Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_card_products".* FROM "processor_gateway_card_products" WHERE "processor_gateway_card_products"."id" = $1 LIMIT $2[0m  [["id", "default-physical"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.6ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" INNER JOIN "processor_gateway_card_products" ON "processor_gateway_card_products"."id" = "processor_gateway_cards"."card_product_id" WHERE "processor_gateway_cards"."processor_card_id" = $1 AND "processor_gateway_card_products"."account_id" = $2 ORDER BY "processor_gateway_cards"."created_at" ASC LIMIT $3[0m  [["processor_card_id", "9e00f16c4cc9"], ["account_id", "simulator"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Create (0.9ms)[0m  [1m[32mINSERT INTO "processor_gateway_cards" ("id", "card_product_id", "processor_card_id", "pan", "transaction_handler", "created_at", "updated_at", "options") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["id", "9e00f16c4cc9"], ["card_product_id", "default-physical"], ["processor_card_id", "9e00f16c4cc9"], ["pan", "4111111111161237"], ["transaction_handler", "{\"object\":\"payment_process\",\"id\":null}"], ["created_at", "2020-12-26 15:08:31.215326"], ["updated_at", "2020-12-26 15:08:31.215326"], ["options", "{\"marqeta_user_token\":\"a0a14f38b7ba45e62abfbc697e605e5d\"}"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."id" = $1 LIMIT $2[0m  [["id", "9e00f16c4cc9"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (0.8ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "card_id", "transaction_handler", "currency", "amount_requested", "amount_approved", "merchant_trade_name", "mcc", "created_at", "processor_transaction_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["type", "authorization"], ["card_id", "9e00f16c4cc9"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "USD"], ["amount_requested", 1000], ["amount_approved", 1000], ["merchant_trade_name", "trade name"], ["mcc", "5812"], ["created_at", "2020-12-26 15:08:31.225786"], ["processor_transaction_id", "776b3331a90b45dae3f03ab4de72f3b6"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Card Load (0.3ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "9e00f16c4cc9"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (2.0ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "9e00f16c4cc9"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (1.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "9e00f16c4cc9"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.4ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "776b3331a90b45dae3f03ab4de72f3b6"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.5ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "776b3331a90b45dae3f03ab4de72f3b6"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Card Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_cards".* FROM "processor_gateway_cards" WHERE "processor_gateway_cards"."processor_card_id" = $1 LIMIT $2[0m  [["processor_card_id", "9e00f16c4cc9"], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (1.0ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["type", "capture"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Create (1.1ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "c3578707-959d-42b8-8239-8721ccfd667f"], ["type", "capture"], ["parent_transaction_id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["card_id", "9e00f16c4cc9"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:31.245579"], ["created_at", "2020-12-26 15:08:31.269324"], ["processor_transaction_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["card_acceptor_id", "ccd48945-cba3-4c84-905e-1fff4095aab7"], ["acquirer_id", "2b445d26-fceb-4506-945e-15e31bbe69ca"], ["terminal_id", "48da2e58-5fda-4837-b1d0-0785baab5092"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2[0m  [["id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (1.6ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "776b3331a90b45dae3f03ab4de72f3b6"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Load (0.9ms)[0m  [1m[34mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 ORDER BY "processor_gateway_transactions"."created_at" ASC LIMIT $2[0m  [["processor_transaction_id", "776b3331a90b45dae3f03ab4de72f3b6"], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Update (1.2ms)[0m  [1m[33mUPDATE "processor_gateway_transactions" SET "transaction_handler_id" = $1, "amount_approved" = $2 WHERE "processor_gateway_transactions"."id" = $3[0m  [["transaction_handler_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["amount_approved", 10000], ["id", "c3578707-959d-42b8-8239-8721ccfd667f"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.8ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_2[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["LIMIT", 1]]
  [1m[36mProcessorGateway::Transaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_2[0m
  [1m[36mProcessorGateway::Transaction Load (0.7ms)[0m  [1m[37mSELECT "processor_gateway_transactions".* FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["LIMIT", 1]]
  [1m[35m (2.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mProcessorGateway::Transaction Exists? (6.0ms)[0m  [1m[34mSELECT 1 AS one FROM "processor_gateway_transactions" WHERE "processor_gateway_transactions"."processor_transaction_id" = $1 AND "processor_gateway_transactions"."type" = $2 LIMIT $3[0m  [["processor_transaction_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["type", "capture"], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mProcessorGateway::Transaction Create (4.2ms)[0m  [1m[32mINSERT INTO "processor_gateway_transactions" ("id", "type", "parent_transaction_id", "card_id", "transaction_handler", "currency", "amount_requested", "merchant_trade_name", "mcc", "processor_datetime", "created_at", "processor_transaction_id", "card_acceptor_id", "acquirer_id", "terminal_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) RETURNING "id"[0m  [["id", "e61970fd-2254-49b1-a217-004f8ba1dee5"], ["type", "capture"], ["parent_transaction_id", "51acc78f-375a-4158-abc8-f8a9f826ac84"], ["card_id", "9e00f16c4cc9"], ["transaction_handler", "{\"id\":null,\"object\":\"payment_process\"}"], ["currency", "CAD"], ["amount_requested", 10000], ["merchant_trade_name", "Unknown Merchant"], ["mcc", "5812"], ["processor_datetime", "2020-12-26 15:08:31.247680"], ["created_at", "2020-12-26 15:08:31.320970"], ["processor_transaction_id", "02121394-c251-4b30-b51f-ecb1a28ff3f7"], ["card_acceptor_id", "f3ddfacd-d4fb-4ab4-a892-84fa1f4d0ad2"], ["acquirer_id", "01d1b8d5-2b1a-40c3-9908-f8bdc278f84e"], ["terminal_id", "2b3b0a02-87bf-41f7-b7a8-8e8d555d9a38"]]
  [1m[35m (0.7ms)[0m  [1m[31mROLLBACK[0m
